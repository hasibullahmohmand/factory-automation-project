@page "/gums"
@inject IJSRuntime JS
@inject IUnitOfWork unitOfWork
@rendermode InteractiveServer
@attribute [Authorize]

<PageTitle>Gums</PageTitle>
<div class="message-container">
    @if (!String.IsNullOrEmpty(errorMessage))
    {
    <div class="alert alert-danger message" role="alert">
        <i class="fas fa-exclamation-circle"></i>
        @errorMessage
    </div>
    }

    @if (!String.IsNullOrEmpty(successMessage))
    {
        <div class="alert alert-info message" role="alert">
            <i class="fas fa-check-circle"></i>
            @successMessage
        </div>
    }
</div>
<h3 class="heading">Gums</h3>
<div class="main-container">
    @if(_products==null && _products?.Count==0){
        <p>
            <em> Loading...</em>
        </p>
    }else{
        @foreach (var product in _products)
        {
            <div class="product-container">
                <div class="product-img">
                    <img src="@product.ImageUrl" alt="Product Image" />
                </div>
                <div class="product-name">
                    <b>@product.Name</b>
                </div>
                <div class="product-price">
                    @product.Price TL
                </div>
                <div class="product-detail">
                    @product.Description
                </div>
                <button class="btn btn-outline-info btn-primary text-light" @onclick="() => AddToCart(product.Id)">
                    <i class="fas fa-shopping-cart me-2"></i> Add To Cart
                </button>
            </div>  
        }
    }
</div>

@code {
    private string errorMessage = string.Empty;
    private string successMessage = string.Empty;
    private List<ResultProductDto> _products = [];
    private CreateCartDto createCartDto = new();

    protected override async Task OnInitializedAsync()
    {
        _products = await unitOfWork.ProductService.GetProductByCateogryIdAsync(3);
        //3 for Gums
    }

    private async Task AddToCart(int productId)
    {
        createCartDto.productId = productId;
        var result = await unitOfWork.CartService.CreateCartAsync(createCartDto);
        if (!result)
        {
            errorMessage = "An error occured!";
            StateHasChanged();
        }
        else
        {
            successMessage = "Product added to cart!";
            StateHasChanged();
        }
    }
}
